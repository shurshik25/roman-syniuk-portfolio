let e=-1;const t=t=>{addEventListener("pageshow",n=>{n.persisted&&(e=n.timeStamp,t(n))},!0)},n=(e,t,n,i)=>{let r,s;return o=>{t.value>=0&&(o||i)&&(s=t.value-(r??0),(s||void 0===r)&&(r=t.value,t.delta=s,t.rating=((e,t)=>e>t[1]?"poor":e>t[0]?"needs-improvement":"good")(t.value,n),e(t)))}},i=e=>{requestAnimationFrame(()=>requestAnimationFrame(()=>e()))},r=()=>{const e=performance.getEntriesByType("navigation")[0];if(e&&e.responseStart>0&&e.responseStart<performance.now())return e},s=()=>{const e=r();return e?.activationStart??0},o=(t,n=-1)=>{const i=r();let o="navigate";return e>=0?o="back-forward-cache":i&&(document.prerendering||s()>0?o="prerender":document.wasDiscarded?o="restore":i.type&&(o=i.type.replace(/_/g,"-"))),{name:t,value:n,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:o}},a=new WeakMap;function d(e,t){return a.get(e)||a.set(e,new t),a.get(e)}class c{t;i=0;o=[];h(e){if(e.hadRecentInput)return;const t=this.o[0],n=this.o.at(-1);this.i&&t&&n&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(this.i+=e.value,this.o.push(e)):(this.i=e.value,this.o=[e]),this.t?.(e)}}const l=(e,t,n={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(e)){const i=new PerformanceObserver(e=>{Promise.resolve().then(()=>{t(e.getEntries())})});return i.observe({type:e,buffered:!0,...n}),i}}catch{}},h=e=>{let t=!1;return()=>{t||(e(),t=!0)}};let u=-1;const p=new Set,m=()=>"hidden"!==document.visibilityState||document.prerendering?1/0:0,v=e=>{if("hidden"===document.visibilityState){if("visibilitychange"===e.type)for(const e of p)e();isFinite(u)||(u="visibilitychange"===e.type?e.timeStamp:0,removeEventListener("prerenderingchange",v,!0))}},f=()=>{if(u<0){const e=s(),n=document.prerendering?void 0:globalThis.performance.getEntriesByType("visibility-state").filter(t=>"hidden"===t.name&&t.startTime>e)[0]?.startTime;u=n??m(),addEventListener("visibilitychange",v,!0),addEventListener("prerenderingchange",v,!0),t(()=>{setTimeout(()=>{u=m()})})}return{get firstHiddenTime(){return u},onHidden(e){p.add(e)}}},g=e=>{document.prerendering?addEventListener("prerenderingchange",()=>e(),!0):e()},T=[1800,3e3],y=(e,r={})=>{g(()=>{const a=f();let d,c=o("FCP");const h=l("paint",e=>{for(const t of e)"first-contentful-paint"===t.name&&(h.disconnect(),t.startTime<a.firstHiddenTime&&(c.value=Math.max(t.startTime-s(),0),c.entries.push(t),d(!0)))});h&&(d=n(e,c,T,r.reportAllChanges),t(t=>{c=o("FCP"),d=n(e,c,T,r.reportAllChanges),i(()=>{c.value=performance.now()-t.timeStamp,d(!0)})}))})},C=[.1,.25],P=(e,r={})=>{const s=f();y(h(()=>{let a,h=o("CLS",0);const u=d(r,c),p=e=>{for(const t of e)u.h(t);u.i>h.value&&(h.value=u.i,h.entries=u.o,a())},m=l("layout-shift",p);m&&(a=n(e,h,C,r.reportAllChanges),s.onHidden(()=>{p(m.takeRecords()),a(!0)}),t(()=>{u.i=0,h=o("CLS",0),a=n(e,h,C,r.reportAllChanges),i(()=>a())}),setTimeout(a))}))};let b=0,L=1/0,S=0;const E=e=>{for(const t of e)t.interactionId&&(L=Math.min(L,t.interactionId),S=Math.max(S,t.interactionId),b=S?(S-L)/7+1:0)};let w;const A=()=>w?b:performance.interactionCount??0;let I=0;class F{u=[];l=new Map;m;p;v(){I=A(),this.u.length=0,this.l.clear()}L(){const e=Math.min(this.u.length-1,Math.floor((A()-I)/50));return this.u[e]}h(e){if(this.m?.(e),!e.interactionId&&"first-input"!==e.entryType)return;const t=this.u.at(-1);let n=this.l.get(e.interactionId);if(n||this.u.length<10||e.duration>t.P){if(n?e.duration>n.P?(n.entries=[e],n.P=e.duration):e.duration===n.P&&e.startTime===n.entries[0].startTime&&n.entries.push(e):(n={id:e.interactionId,entries:[e],P:e.duration},this.l.set(n.id,n),this.u.push(n)),this.u.sort((e,t)=>t.P-e.P),this.u.length>10){const e=this.u.splice(10);for(const t of e)this.l.delete(t.id)}this.p?.(n)}}}const M=e=>{const t=globalThis.requestIdleCallback||setTimeout;"hidden"===document.visibilityState?e():(e=h(e),addEventListener("visibilitychange",e,{once:!0,capture:!0}),t(()=>{e(),removeEventListener("visibilitychange",e,{capture:!0})}))},k=[200,500],B=(e,i={})=>{if(!globalThis.PerformanceEventTiming||!("interactionId"in PerformanceEventTiming.prototype))return;const r=f();g(()=>{"interactionCount"in performance||w||(w=l("event",E,{type:"event",buffered:!0,durationThreshold:0}));let s,a=o("INP");const c=d(i,F),h=e=>{M(()=>{for(const n of e)c.h(n);const t=c.L();t&&t.P!==a.value&&(a.value=t.P,a.entries=t.entries,s())})},u=l("event",h,{durationThreshold:i.durationThreshold??40});s=n(e,a,k,i.reportAllChanges),u&&(u.observe({type:"first-input",buffered:!0}),r.onHidden(()=>{h(u.takeRecords()),s(!0)}),t(()=>{c.v(),a=o("INP"),s=n(e,a,k,i.reportAllChanges)}))})};class H{m;h(e){this.m?.(e)}}const x=[2500,4e3],N=(e,r={})=>{g(()=>{const a=f();let c,u=o("LCP");const p=d(r,H),m=e=>{r.reportAllChanges||(e=e.slice(-1));for(const t of e)p.h(t),t.startTime<a.firstHiddenTime&&(u.value=Math.max(t.startTime-s(),0),u.entries=[t],c())},v=l("largest-contentful-paint",m);if(v){c=n(e,u,x,r.reportAllChanges);const s=h(()=>{m(v.takeRecords()),v.disconnect(),c(!0)}),a=e=>{e.isTrusted&&(M(s),removeEventListener(e.type,a,{capture:!0}))};for(const e of["keydown","click","visibilitychange"])addEventListener(e,a,{capture:!0});t(t=>{u=o("LCP"),c=n(e,u,x,r.reportAllChanges),i(()=>{u.value=performance.now()-t.timeStamp,c(!0)})})}})},R=[800,1800],q=e=>{document.prerendering?g(()=>q(e)):"complete"!==document.readyState?addEventListener("load",()=>q(e),!0):setTimeout(e)},D=(e,i={})=>{let a=o("TTFB"),d=n(e,a,R,i.reportAllChanges);q(()=>{const c=r();c&&(a.value=Math.max(c.responseStart-s(),0),a.entries=[c],d(!0),t(()=>{a=o("TTFB",0),d=n(e,a,R,i.reportAllChanges),d(!0)}))})};export{C as CLSThresholds,T as FCPThresholds,k as INPThresholds,x as LCPThresholds,R as TTFBThresholds,P as onCLS,y as onFCP,B as onINP,N as onLCP,D as onTTFB};
